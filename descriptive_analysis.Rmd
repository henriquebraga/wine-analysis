--- 
title: "descriptive_analysis_wine"
author: "Henrique Braga"
date: "September 2, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


## Instalacao dos pacotes

Instale os pacotes para poder realizar a análise descritiva:

```{r install_packages}
install.packages('dplyr')
install.packages('plotly')
```

## Carregar bibliotecas
```{r load_libraries}
library(plotly)
library(dplyr)
```

## Analise: Estatistica Descritiva

### Carregando o dataset 

Primeiramente, precisamos carregar nosso conjunto de dados.

```{r load_dataset}
wines_dt <- read.csv2("wines.csv", row.names=1)
```

### Uma primeira olhada no dataset

#### Amostras

Verificando alguns exemplos (10 amostras) de amostra para saber quais colunas existem em nosso dataset.

```{r dataset_samples}
head(wines_dt, n=10)
```

#### Visão Geral
Vamos dar uma primeira olhada geral em nosso dados.

```{r summary_dataset}
summary(wines_dt)
```

```{r summary_dataset}
summary(wines_dt)
```

Podemos já verificar alguns comportamentos:

* Existe uma divisão entre vinhos tinto e branco;
* O campo `redis ualsugar` possui um grande desvio padrao se comparado aos outros campos. (Isso pode ser visto entre a diferenca da média para a mediana);
* Aparentemente há alguns outliers em boa parte dos campos do dataset (Isso pode ser visto pelos quartis);

Vamos guardar essas informações para outro momento e continuar nossa análise.

### Verificando valores nulos

Antes de prosseguirmos com a análise, precisamos verificar se existem registros sem dados.

```{r fix_wines}
sapply(wines_dt, function(x)all(is.na(x)))
```

Como resultado retornado para todas as colunas foi `FALSE`, averiguamos que não existem valores nulos em nosso data set.

### Distribuição dos dados

Vamos agora analisar a distribuição dos dados de cada coluna. Com isso, conseguiremos também ver os outliers.

```{r data_distribution_fixedacididty}
plot_ly(x = wines_dt$fixedacidity, type = 'histogram')
```

```{r data_distribution_volatileacidity}
plot_ly(x = wines_dt$volatileacidity, type = 'histogram')
```

```{r data_distribution_citricacid}
plot_ly(x = wines_dt$citricacid, type = 'histogram')
```

```{r data_distribution_residualsugar}
plot_ly(x = wines_dt$residualsugar, type = 'histogram')
```

```{r data_distribution_chlorides}
plot_ly(x = wines_dt$chlorides, type = 'histogram')
```

```{r data_distribution_freesulfurdioxide}
plot_ly(x = wines_dt$freesulfurdioxide, type = 'histogram')
```

```{r data_distribution_totalsulfurdioxide}
plot_ly(x = wines_dt$totalsulfurdioxide, type = 'histogram')
```

```{r data_distribution_density}
plot_ly(x = wines_dt$density, type = 'histogram')
```

```{r data_distribution_ph}
plot_ly(x = wines_dt$pH, type = 'histogram')
```

```{r data_distribution_ph}
plot_ly(x = wines_dt$pH, type = 'histogram')
```

```{r data_distribution_sulphates}
plot_ly(x = wines_dt$sulphates, type = 'histogram')
```

```{r data_distribution_sulphates}
plot_ly(x = wines_dt$sulphates, type = 'histogram')
```

```{r data_distribution_alcohol}
plot_ly(x = wines_dt$alcohol, type = 'histogram')
```

```{r data_distribution_quality}
plot_ly(x = wines_dt$quality, type = 'histogram')
```

```{r data_distribution_quality}
plot_ly(x = wines_dt$Vinho, type = 'histogram')
```

Com exceção do campo `vinhos` que é uma variável categórica, todos os campos numéricos seguem uma distribuição normal, apesar da presença de alguns outliers que iremos verificar posteriormente na análise.

Vemos também que a quantidade de vinhos brancos é muito maior que vinho tinto.

No tópico a seguir, vamos confirmar esse comportamento, analisando as medidas centrais do conjunto de dados: media e mediana.

### Média e Mediana: Vinhos Tintos x Vinhos Brancos

```{r data_mean_dt_wine}
aggregate(wines_dt[,-13],
          by = list(wines_dt$Vinho),
          FUN = mean)
```

```{r data_median_dt_wine}
aggregate(wines_dt[,-13],
          by = list(wines_dt$Vinho),
          FUN = median)
```

Podemos observar algumas diferenças interessantes entre os mesmos: 

* A acidez para vinhos tintos é maior;
* A volatidade de ácido é duas vezes maior em vinhos tintos;
* O açúcar é maior para vinhos brancos;
* O dióxido de carbono é mais que o dobro nos vinhos brancos;
* Os outros campos são similares.


Analisando a assimetria (diferença entre média e mediana) e conforme verificamos nos histogramas acima, as colunas de vinhos seguem uma distribuição normal. Vamos fazer um plot das maiores diferenças entre média e mediana. O campo que teve uma diferença mais significativa foi o dióxido de carbono.

```{r median_mean_hist}
plot_ly(x = wines_dt$freesulfurdioxide, type = 'histogram')
```

Podemos observar que apesar do desenho ser similar à uma distribuição normal, isso se deu pois mais à esquerda, temos uma grande concentração de amostras.

### Desvio Padrão e Outliers

Vamos verificar agora quem são os outliers por coluna em nosso conjunto de dados por meio de boxplots.

```{r boxplot_outliers}
boxplot(wines_dt$quality, data=wines_dt, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Qualidade")

boxplot(wines_dt$density, data=wines_dt, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Densidade")

boxplot(wines_dt$sulphates, data=wines_dt, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Sulfatos")

boxplot(wines_dt$chlorides, data=wines_dt, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Cloreto")

boxplot(wines_dt$volatileacidity, data=wines_dt, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Volatilidade do ácido")

boxplot(wines_dt$citricacid, data=wines_dt, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Ácido Cítrico")

boxplot(wines_dt$residualsugar, data=wines_dt, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Açúcar")

boxplot(wines_dt$pH, data=wines_dt, col=(c("blue","darkgreen")),
  main="pH", xlab="Sulfatos")

```

Podemos observar pelo boxplot que com exceção de qualidade e denpsidade, todos os campos possuem uma quantidade alta de outliers. Posteriormente, dividiremos o conjunto de dados para verificar se os tipos de vinho (denotado pelo campo VINHO) devem ser agrupados e tratados separadamente.

### Correlações

## Dividindo o conjunto de dados: Vinhos brancos e Vinhos tintos

Vamos utilizar as observações obtidas em nossa análise inicial e verificar se há uma discrepância entre os tipos de vinho.


Primeiramente, criaremos um conjunto de dados de vinhos vermelhos.

```{r filter_wine_datasets_red}
wines_dt.red_wines <- wines_dt %>% filter(Vinho == 'RED')
wines_dt.red_wines
```

Agora, o conjunto de dados somente com os vinhos brancos.

```{r filter_wine_datasets_white}
wines_dt.white_wines <- wines_dt %>% filter(Vinho == 'WHITE')
wines_dt.white_wines
```

```{r summary_wine_datasets_white}
summary(wines_dt.white_wines)
```

```{r summary_wine_datasets_red}
summary(wines_dt.red_wines)
```

Vamos obter os maiores valores dos campos do dataset por tipo de vinho.

```{r aggregate_wines_dt}
getMaxValueByWineType <- function(dataset) {
  columns <- colnames(wines_dt)[1:12]
  for (columnName in columns[1:12]){
  print(aggregate(wines_dt[columnName], by = list(wines_dt$Vinho), FUN=mean, na.rm = TRUE))
  }  
}
getMaxValueByWineType(wines_dt)
```

Podemos concluir que existe uma grande diferença nos campos para cada tipo de vinho. A acidez, por exemplo, varia praticamente o dobro.

Os maiores valores para qualidade, álcool, densidade, pH, acidez não variaram muito.

### Distribuição do dados por tipo de vinho

Com o dataset separado, vamos verificar se a distribuição de dados diferem entre um e outro.

```{r data_distribution_volatileacidity}
plot_ly(x = wines_dt.red_wines$volatileacidity, type = 'histogram')
plot_ly(x = wines_dt.white_wines$volatileacidity, type = 'histogram')
```

```{r data_distribution_citricacid_per_wine_type}
plot_ly(x = wines_dt.red_wines$citricacid, type = 'histogram')
plot_ly(x = wines_dt.white_wines$citricacid, type = 'histogram')
```

```{r data_distribution_residualsugar_per_wine_type}
plot_ly(x = wines_dt.red_wines$residualsugar, type = 'histogram')
plot_ly(x = wines_dt.white_wines$residualsugar, type = 'histogram')

```

```{r data_distribution_chlorides_per_wine_type}
plot_ly(x = wines_dt.red_wines$chlorides, type = 'histogram')
plot_ly(x = wines_dt.white_wines$chlorides, type = 'histogram')
```

```{r data_distribution_freesulfurdioxide_per_wine_type}
plot_ly(x = wines_dt.red_wines$freesulfurdioxide, type = 'histogram')
plot_ly(x = wines_dt.white_wines$freesulfurdioxide, type = 'histogram')
```

```{r data_distribution_totalsulfurdioxide_per_wine_type}
plot_ly(x = wines_dt.red_wines$totalsulfurdioxide, type = 'histogram')
plot_ly(x = wines_dt.white_wines$totalsulfurdioxide, type = 'histogram')
```

```{r data_distribution_density_per_wine_type}
plot_ly(x = wines_dt.red_wines$density, type = 'histogram')
plot_ly(x = wines_dt.white_wines$density, type = 'histogram')
```

```{r data_distribution_ph_per_wine_type}
plot_ly(x = wines_dt.red_wines$pH, type = 'histogram')
plot_ly(x = wines_dt.white_wines$pH, type = 'histogram')
```

```{r data_distribution_sulphates_per_wine_type}
plot_ly(x = wines_dt.red_wines$sulphates, type = 'histogram')
plot_ly(x = wines_dt.white_wines$sulphates, type = 'histogram')
```

```{r data_distribution_alcohol_per_wine_type}
plot_ly(x = wines_dt.red_wines$alcohol, type = 'histogram')
plot_ly(x = wines_dt.white_wines$alcohol, type = 'histogram')
```

```{r data_distribution_quality_per_wine_type}
plot_ly(x = wines_dt.red_wines$quality, type = 'histogram')
plot_ly(x = wines_dt.white_wines$quality, type = 'histogram')
```

```{r data_distribution_quality}
plot_ly(x = wines_dt$Vinho, type = 'histogram')
```

### Outliers: Vinhos brancos x Vinhos tintos

Verificamos na análise inicial antes de agruparmos por tipo de vinho, que haviam um grande número de outliers em diversos campos. Vamos verificar se isso ainda está ocorrendo.

```{r boxplot_outliers_red_wines}
boxplot(wines_dt.red_wines$quality, data=wines_dt.red_wines, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Qualidade")

boxplot(wines_dt.red_wines$density, data=wines_dt.red_wines, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Densidade")

boxplot(wines_dt.red_wines$sulphates, data=wines_dt.red_wines, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Sulfatos")

boxplot(wines_dt.red_wines$chlorides, data=wines_dt.red_wines, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Cloreto")

boxplot(wines_dt.red_wines$volatileacidity, data=wines_dt.red_wines, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Volatilidade do ácido")

boxplot(wines_dt.red_wines$citricacid, data=wines_dt.red_wines, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Ácido Cítrico")

boxplot(wines_dt.red_wines$residualsugar, data=wines_dt.red_wines, col=(c("blue","darkgreen")),
  main="Vinhos", xlab="Açúcar")

boxplot(wines_dt.red_wines$pH, data=wines_dt.red_wines, col=(c("blue","darkgreen")),
  main="pH", xlab="Sulfatos")

```

Vemos que para o vinho tinto, tivemos uma diminuição de outliers (a concentração fica maior no primeiro e segundo quartil) somente no campo ácido cítrico.

Vamos verificar o comportamento do vinho branco:

```{r boxplot_outliers_white_wines}
boxplot(wines_dt.white_wines$quality, data=wines_dt.white_wines, col=(c("blue","darkgreen")),
  main="Vinhos Brancos", xlab="Qualidade")

boxplot(wines_dt.white_wines$density, data=wines_dt.white_wines, col=(c("blue","darkgreen")),
  main="Vinhos Brancos", xlab="Densidade")

boxplot(wines_dt.white_wines$sulphates, data=wines_dt.white_wines, col=(c("blue","darkgreen")),
  main="Vinhos Brancos", xlab="Sulfatos")

boxplot(wines_dt.white_wines$chlorides, data=wines_dt.white_wines, col=(c("blue","darkgreen")),
  main="Vinhos Brancos", xlab="Cloreto")

boxplot(wines_dt.white_wines$volatileacidity, data=wines_dt.white_wines, col=(c("blue","darkgreen")),
  main="Vinhos Brancos", xlab="Volatilidade do ácido")

boxplot(wines_dt.white_wines$citricacid, data=wines_dt.white_wines, col=(c("blue","darkgreen")),
  main="Vinhos Brancos", xlab="Ácido Cítrico")

boxplot(wines_dt.white_wines$residualsugar, data=wines_dt.white_wines, col=(c("blue","darkgreen")),
  main="Vinhos Brancos", xlab="Açúcar")

boxplot(wines_dt.white_wines$pH, data=wines_dt.white_wines, col=(c("blue","darkgreen")),
  main="Vinhos Brancos", xlab="pH")
```

Aqui é interessante: diferentemente do vinho tinto, a quantidade de outliers no campo `volatilidade do ácido` se manteve, no passo que a de `açúcar` diminuiu consideravelmente.
### Transformação da qualidade em variável categórica


```{r quality_scale}
hist(wines_dt$quality)
```